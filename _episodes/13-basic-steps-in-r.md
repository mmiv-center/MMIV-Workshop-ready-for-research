---
title: "Merge spreadsheets"
author: "Hauke Bartsch"
teaching: 15
exercises: 0
questions:
- "How do I read in data with R?"
- "How can I merge data spreadsheets?"
objectives:
- "Be familiar with R import for data, data frames and data types"
keypoints:
- "Document basic analysis steps and data cleaning. Script every step to make them reproducible."
---

> ## You can skip this lesson if you can answer these questions: &#8680;
>
>  - Know the difference between and outer and inner join?
>  - Know how to identify outliers in processed data?
>  - Know how to create a table 1?
{: .challenge}

# Module 1: Table data

## Merge two data dictionaries

R has some convenient tools to merge tables. A table in R is called a data frame and contains columns of different types. Some of the usual types are numbers, dates, or categorical (factor) variables such as "YES", "NO". R will attempt to guess the type of a column based on the values. If for example a single entry in a column is a string like "NA" the whole column will be interpreted as a categorical column.

Lets start by downloading two test spreadsheets in csv format that contain cortical brain volumes for an imaginary study. Both spreadsheets have been generated by independent workflows on the same image data and we would like to merge them into a single spreadsheet.

~~~
git clone https://github.com/mmiv-center/MMIV-Workshop-ready-for-research.git rfr
cp rfr/data/d1.csv .
cp rfr/data/d2.csv .
\rm -R rfr
~~~

After these steps the current directory should contain two spreadsheet files that we want to read into R, merge and export again as a new spreadsheet.

### Read spreadsheet

Start R - or RStudio in the directory that contains the two spreadsheets d1.csv and d2.csv.
~~~
d1 = read.csv('d1.csv')
d2 = read.csv('d2.csv')
head(d1)
  PatientID PatientName  StudyDate Vol_Hippocampus Vol_Amygdala
1      P000        P000 2019-01-01       5200.0000      1000.00
2      P001        P001 2016-11-21       1157.6257     51768.29
3      P002        P002 2014-02-14        649.2979     83026.74
4      P003        P003 2002-06-15       3770.4686     65333.37
5      P004        P004 2012-10-26       2507.1122     78808.67
6      P005        P005 2012-07-21       2278.5445     48285.86
head(d2)
    ID Name  StudyDate intra_cranial_volume Vol_Amygdala_l Sex
1 P261 P261 2006-12-21              5934.39       7406.052   F
2 P007 P007 2007-03-24             91239.56      44318.554   M
3 P090 P090 2001-12-29             37423.75      21252.110   F
4 P359 P359 1999-04-15             67589.93      42039.087   F
5 P442 P442 2009-06-06             58514.27      42226.353   F
6 P285 P285 2014-07-25             93801.87      31924.944   M
~~~

### Merge the two spreadsheets

In order to merge the spreadsheets we need to identify one or more columns that can be used to match the data from table d1 to table d2.
~~~
dall = merge(d1, d2, by.x=c("PatientID", "PatientName", "StudyDate"), by.y=c("ID", "Name", "StudyDate"), all.x=T, all.y=T)
~~~

### Save the result again

~~~
write.csv(dall, file="dall.csv", row.names=F)
~~~


## Table 1

One of the first steps in a project is to describe your raw data. In R we can use the 'tableone' package.

~~~
install.packages('tableone')
install.packages('stargazer')
library('tableone')
library('stargazer')
varList = c("Vol_Hippocampus", "Vol_Amygdala", "intra_cranial_volume", "Vol_Amygdala_l", "Sex")
table1 = CreateTableOne(vars = varList, data = dall)
stargazer(print(table1))
~~~
